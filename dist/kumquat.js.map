{"version":3,"sources":["node_modules/browser-pack/_prelude.js","src/kumquat.js","src/lib/DOMUtils.js","src/lib/KSParser.js","src/lib/Robot.js","src/lib/Utils.js"],"names":[],"mappings":"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","file":"kumquat.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","const dom = require('./lib/DOMUtils');\nconst KSParser = require('./lib/KSParser');\nconst Robot = require('./lib/Robot');\nconst Utils = require('./lib/Utils');\n\nclass kumquat {\n    static create (opts) {\n        let instance = new kumquat(opts);\n        instance.render();\n        return instance;\n    }\n\n    static init (parentNode = 'body') {\n        parentNode = dom.toEl(parentNode);\n\n        parentNode.querySelectorAll('.kumquat-terminal').forEach(kumquat._from);\n    }\n\n    static _from (node) {\n        let dataset = node.dataset;\n        let cfg = {\n            renderTo: node\n        };\n\n        if (dataset.kumquatTitle) {\n            cfg.title = dataset.kumquatTitle;\n        }\n\n        if (dataset.kumquatCode) {\n            cfg.code = dataset.kumquatCode === 'false' ? false : dataset.kumquatCode;\n        }\n\n        if (dataset.kumquatCodeSrc) {\n            cfg.codeSrc = dataset.kumquatCodeSrc;\n        }\n\n        if (dataset.kumquatScriptSrc) {\n            cfg.scriptSrc = dataset.kumquatScriptSrc;\n        }\n\n        kumquat.create(cfg);\n    }\n\n    // -------------------------------------\n\n    constructor (cfg) {\n        this.config = Object.assign({}, {\n            code: '',\n            theme: 'default',\n            renderTo: 'body'\n        }, cfg);\n    }\n\n    set title (title) {\n        if (title) {\n            this._title = title;\n            this._ktTitleEl.innerHTML = this._title;\n        }\n    }\n\n    get title () {\n        return this._title;\n    }\n\n    get robot () {\n        if (!this._robot) {\n            this._robot = new Robot({\n                target: this._ktCliEl\n            });\n        }\n        return this._robot;\n    }\n\n    render () {\n        let me = this;\n        let cfg = me.config;\n\n        cfg.renderToEl = dom.toEl(cfg.renderTo);\n\n        if (!cfg.renderToEl) {\n            throw Error(`Selector ${cfg.renderTo} is not valid.`);\n        }\n\n\n        if (cfg.renderToEl === document.body || !dom.hasCls(cfg.renderToEl, 'kumquat-terminal')) {\n            me._ktEl = dom.create(`${cfg.id ? '#' + cfg.id : ''}.kumquat-terminal`)\n            dom.appendElTo(cfg.renderToEl, me._ktEl);\n        } else {\n            me._ktEl = cfg.renderToEl;\n        }\n\n        let domState = dom.survey(me._ktEl, `(.header>.btn.green+.btn.yellow+.btn.red+.title)+(.terminal>(.cli>.line>span.cursor)+.code)`);\n        dom.appendElTo(me._ktEl,\n            dom.appendElTo((domState['.header'].el || dom.create('.header')),\n                (domState['.btn.red'].el || dom.create('.btn.red')),\n                (domState['.btn.yellow'].el || dom.create('.btn.yellow')),\n                (domState['.btn.green'].el || dom.create('.btn.green')),\n                (domState['.title'].el || dom.create('.title', cfg.title))\n            ),\n            dom.appendElTo((domState['.terminal'].el || dom.create('.terminal')),\n                (domState['.cli'].el || dom.create('.cli')),\n                (domState['.code'].el || dom.create('.code'))\n            )\n        );\n\n        me._ktTitleEl = me._ktEl.querySelector('.header > .title');\n        me._ktCliEl = me._ktEl.querySelector('.terminal > .cli');\n        me._ktCodeEl = me._ktEl.querySelector('.terminal > .code');\n\n        me.title = cfg.title;\n\n        if (cfg.code === false) {\n            dom.addCls(me._ktCodeEl, 'hidden');\n        } else {\n            dom.update(me._ktCodeEl, cfg.code)\n        }\n\n        if (cfg.codeSrc) {\n            Utils.loadFileContents(cfg.codeSrc, (contents) => {\n                dom.update(me._ktCodeEl, `<pre><code>${contents}</code></pre>`);\n            });\n        }\n\n        if (cfg.scriptSrc) {\n            Utils.loadFileContents(cfg.scriptSrc, (contents) => {\n                me.robot.process(KSParser.parse(contents));\n            });\n        }\n\n        me.robot.process([{\n            action: 'prompt'\n        }]);\n    }\n\n    code (contents = '') {\n        this._ktCodeEl.innerHTML = contents;\n    }\n\n    type (line) {\n        this.robot.process({\n            text: line,\n            action: 'type'\n        });\n    }\n\n    process (conf = {}) {\n\n    }\n}\n\nmodule.exports = global.kumquat = kumquat;","let _parse = (selector) => {\n    var obj = {tag:'', classes:[], id: ''};\n    selector.split(/(?=\\.)|(?=#)/).forEach((token) =>{\n        switch (token[0]) {\n            case '#':\n                if (!obj.id) {\n                    obj.id = token.slice(1);\n                }\n                break;\n            case '.':\n                obj.classes.push(token.slice(1));\n                break;\n            default :\n                if (!obj.tag) {\n                    obj.tag = token;\n                }\n                break;\n        }\n    });\n    return obj;\n};\n\nclass DOMUtils {\n    static create (selector = 'div', innerHTML = '') {\n        let def = _parse(selector);\n        let el = document.createElement(def.tag || 'div');\n        el.innerHTML = innerHTML;\n        if (def.id) {\n            el.setAttribute('id', def.id);\n        }\n        if (def.classes.length > 0) {\n            DOMUtils.addCls(el, ...def.classes);\n        }\n        return el;\n    }\n\n    static addCls (el, ...cls) {\n        cls.forEach((c) => el.classList.add(c));\n        return el;\n    }\n\n    static hasCls (el, cls) {\n        return el.classList.contains(cls);\n    }\n\n    static appendElTo (el, ...child) {\n        child.forEach((c) => el.appendChild(c));\n        return el;\n    }\n\n    static update (el, html) {\n        el.innerHTML = html;\n        return el;\n    }\n\n    static appendTo (el, html) {\n        el.innerHTML += html;\n        return el;\n    }\n\n    static replaceIn (el, search, replace) {\n        return DOMUtils.update(el, el.innerHTML.replace(search, replace));\n    }\n\n    static removeChild (el, childSelector) {\n        var child = DOMUtils.getChild(el, childSelector);\n        if (child) {\n            child.parentNode.removeChild(child);\n            child = null;\n        }\n        return el;\n    }\n\n    static getChild (el, childSelector) {\n        return el.querySelector(childSelector)\n    }\n\n    static isEl (obj) {\n        try {\n            return (obj instanceof HTMLElement);\n        } catch (e) {\n            return ((typeof obj === \"object\") &&\n                (obj.nodeType === 1) && (typeof obj.style === \"object\") &&\n                (typeof obj.ownerDocument === \"object\"));\n        }\n    }\n\n    static toEl (strOrEl) {\n        if (strOrEl instanceof String || typeof strOrEl === 'string') {\n            return document.querySelector(strOrEl);\n        } else if (DOMUtils.isEl(strOrEl)) {\n            return strOrEl;\n        }\n    }\n\n    static scrollToBottom (el) {\n        el.scrollTop = el.scrollHeight;\n        return el;\n    }\n\n    static survey (el, template) {\n        let isDelimiter = (c) => ['>','(',')','+'].indexOf(c) > -1; // Whether `c` is an 'end-of-token' character\n        let selector = null;   // A selector\n        let selectors = [];  // The selectors in the template string\n        let depth = 0; // 0 means 'root', each +1 means child of the previous, each -1 means sibling of the parent, same means sibling\n\n        template.split('').forEach((char) => {\n            if (selector !== null) {\n                if (isDelimiter(char)) {\n                    selectors.push({\n                        token: selector,\n                        depth\n                    });\n                    switch (char) {\n                        case '>':\n                        case '(':\n                            depth++;\n                            break;\n                        case ')':\n                            depth-=2;\n                            break;\n                    }\n                }\n                selector = (isDelimiter(char) ? null : selector + char);\n            } else if (!isDelimiter(char)) {\n                selector = char;\n            } else {\n                switch (char) {\n                    case '>':\n                    case '(':\n                        depth ++;\n                        break;\n                    case ')':\n                        depth-=2;\n                        break;\n                }\n            }\n        });\n        if (selector !== null) {\n            selectors.push({\n                token: selector,\n                depth\n            });\n            selector = null;\n        }\n\n        let target;\n        let lastObj = {\n            el: el,\n            depth: -1\n        };\n        let report = {};\n        selectors.forEach((selObj) => {\n            if (selObj.depth > lastObj.depth) {\n                target = lastObj.el;\n            } else if (selObj.depth < lastObj.depth) {\n                target = lastObj.parent.parentNode;\n            } else if (lastObj.el == null && selObj.depth == lastObj.depth) {\n                target = lastObj.parent;\n            }\n            if (target !== null) {\n                let candidates = target.querySelectorAll(selObj.token.replace(/{.*}/g,''));\n                if (candidates.length == 0) {\n                    selObj.el = null;\n                } else {\n                    for (let i = 1; i < candidates.length; i++) {\n                        candidates[i].parentNode.removeChild(candidates[i]);\n                    }\n                    selObj.el = candidates[0];\n                }\n                selObj.parent = target;\n                lastObj = selObj;\n            } else {\n                selObj.el = null;\n            }\n            let token = selObj.token;\n            report[token.replace(/{.*}/g,'')] = {\n                el: selObj.el,\n                parent: selObj.parent,\n                expression: selObj.token\n            };\n        });\n        return report;\n    }\n}\n\nmodule.exports = DOMUtils;","class KSParser {\n    static parse (script) {\n        return new KSParser().parseScript(script);\n    }\n\n    // ------------------------\n\n    constructor () {\n        this.elements = [];\n    }\n\n    parseLine (line) {\n        switch (line[0]) {\n            case '#':\n                // ignore comments\n                return;\n            case '>':\n                this._startType(line);\n                break;\n            case '<':\n                this._startSend(line);\n                break;\n            case '!':\n                if (line[1] == '<') {\n                    this._startGroupSend(line);\n                }\n                break;\n            default:\n                // ignore invalid lines;\n                return;\n        }\n    }\n\n    parseScript (script) {\n        script.split('\\n').forEach(this.parseLine.bind(this));\n        return this._build();\n    }\n\n    _build () {\n        return this.elements;\n    }\n\n    _startSend (line) {\n        let text = '';\n\n        text = line.slice(1).trim();\n\n        text += '\\n';\n        this.elements.push({\n            action: 'send',\n            text\n        });\n    }\n\n    _startType (line) {\n        let text = '';\n\n        text = line.slice(1).trim();\n\n        text += '\\n';\n        this.elements.push({\n            action: 'type',\n            text\n        });\n    }\n\n}\n\nmodule.exports = KSParser;","const dom = require('./DOMUtils');\n\nclass Robot {\n    constructor (opts) {\n        Object.assign(this, {\n            speed: 80\n        }, opts);\n\n        if (!this.target) {\n            throw new Error('The robot needs a target!');\n        } else {\n            this.rootTarget = this.target;\n            this.pushTarget(this.target);\n            delete this.target;\n        }\n    }\n\n    get targetEl () {\n        return (this._targets = this._targets || [])[0];\n    }\n\n    popTarget () {\n        (this._targets = this._targets || []).shift();\n        if (this._targets.length == 0) {\n            this._targets.push(this.rootTarget);\n        }\n    }\n\n    pushTarget (target) {\n        (this._targets = this._targets || []).unshift(target);\n    }\n\n    process (instructions = []) {\n        var me = this;\n\n        if (!Array.isArray(instructions)) {\n            instructions = [instructions];\n        }\n\n        me.instructions = (instructions || []).slice();\n        me.processing = new Date().getTime();\n        me.cancel = false;\n\n        /*\n        function next(cb) {\n            var instruction = me.instructions.shift();\n            if (instruction) {\n                me.promise.then(() => {\n                    me[instruction['action']](instruction, () => next(cb));\n                    dom.scrollToBottom(me.targetEl);\n                });\n            } else {\n                me.processing = false;\n                cb();\n            }\n        }*/\n\n        Promise.all([me.promise || new Promise(() => {})].concat(me.instructions.map(me.processInstruction.bind(this)))).then(() => {\n            me.processing = false;\n        });\n    }\n\n    processInstruction (instruction) {\n        let me = this;\n        return me[instruction['action']](instruction).then(() => {\n            dom.scrollToBottom(me.targetEl);\n        });\n    }\n\n    prompt (instruction) {\n        var me = this;\n        return new Promise((resolve) => {\n            var showPrompt = instruction.showPrompt || true;\n            var newLine = instruction.newLine || true;\n            me.cursor(false);\n            me.popTarget();\n            var line = dom.create(`div${newLine ? '.line' : ''}${showPrompt ? '.with-prompt' : ''}`);\n            dom.appendElTo(me.targetEl, line);\n            me.pushTarget(line);\n            return me.cursor(true).then(resolve);\n        });\n    }\n\n\n    cursor (instruction) {\n        var me = this;\n        return new Promise((resolve) => {\n            if (instruction === true || instruction === false) {\n                instruction = {\n                    show: instruction\n                }\n            }\n            if ('show' in instruction && instruction.show === true) {\n                dom.appendElTo(me.targetEl, dom.create('span.cursor', 'â–ˆ'));\n            } else {\n                dom.removeChild(me.targetEl, '.cursor');\n            }\n            return resolve();\n        });\n    }\n\n    cls (instruction, done) {\n        var me = this;\n        dom.update(me.targetEl, '');\n        if (done) {\n            done();\n        }\n    }\n\n    return(instruction, done) {\n        /*var me = this;\n        me.cliEl.innerHTML = me.cliEl.innerHTML.slice(0, -(instruction[1] + 1));\n        if (done) {\n            done();\n        }*/\n        throw new Error('not yet implemented');\n    }\n\n    send (instruction) {\n        var me = this;\n        return new Promise((resolve) => {\n            let text = instruction.text;\n            me.cursor(false);\n            dom.update(me.targetEl, text);\n            return resolve();\n        });\n    }\n\n    sleep(instruction, done) {\n        var me = this;\n        me.wait = instruction[1] || 500;\n        setTimeout(function () {\n            me.wait = 0;\n            if (done) {\n                done();\n            }\n        }, me.wait);\n    }\n\n    standby(clearScript) {\n        this.cancel = true;\n        this.processing = false;\n        if (clearScript) {\n            this.script = this._script = [];\n        }\n    }\n\n    type (instruction) {\n        var me = this;\n        return new Promise((resolve) => {\n            var text = instruction.text || '';\n            var remainder = text.split('');\n            var script = me.processing;\n\n            function go() {\n                if (remainder[0] === '\\n') {\n                    return me.prompt({});\n                }\n                var deviation = me.speed * (Math.random());\n                me.wait = deviation;\n                setTimeout(function () {\n                    me.wait = 0;\n                    var out = remainder.splice(0, 1);\n                    if (me.cancel === true || me.processing !== script) {\n                        return;\n                    }\n                    me.cursor(false);\n                    dom.appendTo(me.targetEl, `${out}`);\n                    me.cursor(true);\n                    if (remainder.length == 0) {\n                        return resolve();\n                    } else if (me.cancel === false) {\n                        go();\n                    }\n                }, deviation);\n            }\n\n            if (me.cancel === false) {\n                go();\n            }\n        });\n    }\n}\n\nmodule.exports = Robot;","class Utils {\n    static loadFileContents (path, callback) {\n        var httpRequest = new XMLHttpRequest();\n        httpRequest.onreadystatechange = () => {\n            if (httpRequest.readyState === 4 && httpRequest.status === 200 && callback) {\n                callback(httpRequest.responseText);\n            }\n        };\n        httpRequest.open('GET', path);\n        httpRequest.send();\n    }\n}\n\nmodule.exports = Utils;"]}